<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>REAL · Acceso Padres</title>
    <meta name="robots" content="noindex,nofollow">
    <link rel="stylesheet" href="/styles.css" />
</head>

<body>
    <div class="container" style="max-width:420px; margin-top:10vh">
        <!-- Logo + bienvenida -->
        <div class="hero" style="margin:0 0 12px">
            <img src="/img/logo-real.png" alt="REAL" class="hero-logo" />
            <p class="muted" style="margin-top:6px">Bienvenidos a la plataforma para padres del colegio REAL de
                Escuinapa.</p>
            <label>Por favor, inicia sesión.</label>
        </div>

        <div class="card">
            <h3 style="margin:0 0 12px">Iniciar sesión</h3>
            <form id="fPadresLogin" class="row">
                <input class="input" name="username" id="username" placeholder="Usuario" autocomplete="username"
                    required />
                <input class="input" name="password" id="password" type="password" placeholder="Contraseña"
                    autocomplete="current-password" required />

                <div class="actions right">
                    <button class="btn primary" id="btnLogin" type="submit" aria-live="polite">
                        Entrar
                    </button>
                </div>

                <div id="msgLogin" class="subtle" role="status" aria-live="polite"></div>
            </form>
        </div>
        <div class="hero" style="margin:12px 0 12px">
            <label>¿Problemas para iniciar sesión? Ponte en contacto con el colegio.</label>
        </div>
    </div>
</body>

<script>
    (function () {
        const $ = (id) => document.getElementById(id);
        const f = $('fPadresLogin');
        const btn = $('btnLogin');
        const msg = $('msgLogin');

        async function postJson(url, body) {
            const r = await fetch(url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                credentials: 'same-origin',
                body: JSON.stringify(body)
            });
            const t = await r.text();
            let j = {};
            try { j = JSON.parse(t); } catch { j = {}; }
            if (!r.ok) throw new Error(j.error || ('HTTP ' + r.status));
            return j;
        }

        f.addEventListener('submit', async (e) => {
            e.preventDefault();
            msg.textContent = '';

            const username = f.username.value.trim();
            const password = f.password.value;

            if (!username || !password) {
                msg.textContent = 'Completa usuario y contraseña.';
                return;
            }

            // loading state
            const prev = btn.textContent;
            btn.textContent = 'Iniciando sesión…';
            btn.disabled = true;
            f.username.disabled = true;
            f.password.disabled = true;

            try {
                await postJson('/api/padres/login', { username, password });
                // si todo va bien, al selector de hijos
                location.href = '/padres/hijos.html';
            } catch (err) {
                msg.textContent = err.message || 'No se pudo iniciar sesión';
            } finally {
                btn.textContent = prev;
                btn.disabled = false;
                f.username.disabled = false;
                f.password.disabled = false;
            }
        });
    })();
</script>


</html>